% --------------------------------------------------------------------------
\def\leadsheets@date{2014/08/10}
\def\leadsheets@version{0.1-beta}
\def\leadsheets@info{songbook (beta version) (CN)}

\RequirePackage{expl3}
\ProvidesExplPackage{leadsheets}
  {\leadsheets@date}
  {\leadsheets@version}
  {\leadsheets@info}

% --------------------------------------------------------------------------
% required packages:
\RequirePackage{xparse,translations}

% --------------------------------------------------------------------------
% messages:
\msg_new:nnn {leadsheets} {library-missing}
  {
    You've~ requested~ the~ leadsheets~ library~ `#1'~ but~ it~ appears~ to~
    be~ missing~ on~ your~ system.~ Maybe~ you've~ misspelled~ the~ name?~
    Loading~ the~ library~ will~ abort~ \msg_line_context:
  }

% --------------------------------------------------------------------------
% variants of kernel functions:
\cs_generate_variant:Nn \tl_if_eq:nnTF       { xx , V }
\cs_generate_variant:Nn \seq_set_split:Nnn   { Nnx }
\cs_generate_variant:Nn \prop_item:Nn        { NV }
\cs_generate_variant:Nn \seq_item:Nn         { cV }
\cs_generate_variant:Nn \int_to_arabic:n     { V }
\cs_generate_variant:Nn \tl_replace_once:Nnn { NnV }
\cs_generate_variant:Nn \prop_gput:Nnn       { cxx , NVf }
\cs_generate_variant:Nn \msg_error:nnn       { nnV }
\cs_generate_variant:Nn \vbox_set:Nn         { NV }

% --------------------------------------------------------------------------
% temporary variables:
\tl_new:N   \l__leadsheets_tmpa_tl
\tl_new:N   \l__leadsheets_tmpb_tl
\tl_new:N   \l__leadsheets_tmpc_tl
\tl_new:N   \l__leadsheets_tmpd_tl
\bool_new:N \l__leadsheets_tmpa_bool
\dim_new:N  \l__leadsheets_tmpa_dim
\seq_new:N  \l__leadsheets_tmpa_seq
\seq_new:N  \l__leadsheets_tmpb_seq
\int_new:N  \l__leadsheets_tmpa_int
\int_new:N  \l__leadsheets_tmpb_int
\int_new:N  \l__leadsheets_tmpc_int
\box_new:N  \l__leadsheets_tmpa_box

% --------------------------------------------------------------------------
% libraries:
\tl_const:Nn \c__leadsheets_library_extension_tl {tex}

\cs_new_protected:Npn \leadsheets_load_libraries:n #1
  { \clist_map_inline:nn {#1} { \leadsheets_load_library:n {##1} } }

\cs_new_protected:Npn \leadsheets_load_library:n #1
  {
    \tl_set:Nx \l__leadsheets_tmpa_tl { \tl_trim_spaces:n {#1} }
    \__leadsheets_load_library:V \l__leadsheets_tmpa_tl
  }

\cs_new_protected:Npn \__leadsheets_load_library:n #1
  {
    \cs_if_exist:cF {leadsheets-library-#1-loaded}
      {
        \file_if_exist:nTF {leadsheets.library.#1.code.tex}
          {
            \@onefilewithoptions
              {leadsheets.library.#1.code}[][]
              \c__leadsheets_library_extension_tl
          }
          { \msg_warning:nnn {leadsheets} {library-missing} {#1} }
      }
  }
\cs_generate_variant:Nn \__leadsheets_load_library:n { V }

\cs_new_protected:Npn \__leadsheets_library:nn #1#2
  {
    \cs_new:cpn {leadsheets-library-#1-loaded} {leadsheets:~`#1'~library}
    \ProvidesFile{leadsheets.library.#1.code.tex}
      [
        \leadsheets@date\space
        v\leadsheets@version\space
        leadsheets~ library~ `#1'~ #2
      ]
  }

\NewDocumentCommand \LeadsheetsExplLibrary {mm}
  { \__leadsheets_library:nn {#1} {#2} \ExplSyntaxOn }

\NewDocumentCommand \LeadsheetsLibrary {mm}
  { \__leadsheets_library:nn {#1} {#2} }

\NewDocumentCommand \loadleadsheetslibraries {m}
  { \leadsheets_load_libraries:n {#1} }

% --------------------------------------------------------------------------
\NewDocumentCommand \setleadsheets {m}
  { \keys_set:nn {leadsheets} {#1} }

% --------------------------------------------------------------------------
\bool_new:N \l__leadsheets_minimal_bool

\DeclareOption{minimal}{\bool_set_true:N \l__leadsheets_minimal_bool}
\ProcessOptions*

\bool_if:NF \l__leadsheets_minimal_bool
  { \loadleadsheetslibraries {songs} }

% --------------------------------------------------------------------------
\tex_endinput:D

TODO:
 - input-notation=english|german, print-notation=english|german => damit man
   wÃ¤hlen kann, ob Akkorde mit `H' oder `B' ein- bzw. ausgegeben werden.
 - Fehlermeldungen/Warnungen
