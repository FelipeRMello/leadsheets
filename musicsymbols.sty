\ProvidesPackage{musicsymbols}[2014/07/24 v0.0 musical symbols (draft) (CN)]
\RequirePackage{etoolbox}

% define a LaTeX font that uses the `musix' font from MusiXTeX:
\DeclareFontFamily{U}{musix}{}%
\DeclareFontShape{U}{musix}{m}{n}{%
  <-12>   musix11
  <12-15> musix13
  <15-18> musix16
  <18-23> musix20
  <23->   musix29
}{}%

% a font switch command:
\newrobustcmd*\musix{\usefont{U}{musix}{m}{n}\selectfont}
% a text font command:
\DeclareTextFontCommand{\textmusix}{\musix}

% the `symbol' command: raises the symnol since most symbols are too low for
% use in normal text:
\newrobustcmd*\musicsymbol[2][0pt]{%
  \raisebox{\dimexpr.5ex+(#1)\relax}{\textmusix{#2}}%
}

% define the symbol
\renewrobustcmd*\sharp       {\musicsymbol[.2ex]{4}\kern-.06em}
\renewrobustcmd*\flat        {\kern-.05em\musicsymbol{2}\kern-.06em}
\renewrobustcmd*\natural     {\musicsymbol{6}\kern-.06em}
\newrobustcmd*\doublesharp   {\musicsymbol{5}\kern-.05em}
\newrobustcmd*\doubleflat    {\kern-.05em\musicsymbol{3}\kern-.06em}
\newrobustcmd*\trebleclef    {\musicsymbol{H}}
\newrobustcmd*\bassclef      {\musicsymbol{J}}
\newrobustcmd*\altoclef      {\musicsymbol{K}}
\newrobustcmd*\allabreve     {\kern-.15em\musicsymbol{R}}
\newrobustcmd*\meterC        {\kern-.15em\musicsymbol{S}}
\newrobustcmd*\wholerest     {\musicsymbol{<}}
\newrobustcmd*\halfrest      {\musicsymbol{=}}
\newrobustcmd*\quarterrest   {\musicsymbol[-1ex]{>}\kern.25em}
\newrobustcmd*\eighthrest    {\musicsymbol[-1ex]{?}\kern.33em}
\newrobustcmd*\sixteenthrest {\musicsymbol[-1ex]{@}\kern.33em}

\newcommand*\mscsym@size{\f@size pt}
\newlength\mscsym@barheight

\newrobustcmd*\mscsym@genericbar[1]{%
  \setlength\mscsym@barheight\mscsym@size
  \rule[-.2\mscsym@barheight]{#1}{\mscsym@barheight}%
}

\newcommand*\mscsym@normalbarwidth{.02em}
\newcommand*\mscsym@thickbarwidth{.15em}
\newcommand*\mscsym@interbarwidth{.1em}

\newrobustcmd*\mscsym@thickbar{%
  \mscsym@genericbar{\mscsym@thickbarwidth}%
}

\newrobustcmd*\mscsym@repeatcolon{%
  \leavevmode
  \setlength\mscsym@barheight\mscsym@size
  \raise.1\mscsym@barheight\hbox{:}%
}

\newrobustcmd*\mscsym@interbar{\kern\mscsym@interbarwidth\relax}

\newrobustcmd*\normalbar{%
  \mscsym@genericbar{\mscsym@normalbarwidth}%
}

\newrobustcmd*\leftrepeat{%
  \mscsym@thickbar
  \mscsym@interbar
  \normalbar
  \mscsym@repeatcolon
}

\newrobustcmd*\rightrepeat{%
  \mscsym@repeatcolon
  \normalbar
  \mscsym@interbar
  \mscsym@thickbar
}

\newrobustcmd*\leftrightrepeat{%
  \mscsym@repeatcolon
  \mscsym@thickbar
  \mscsym@interbar
  \mscsym@thickbar
  \mscsym@repeatcolon
}

\newrobustcmd*\doublebar{%
  \normalbar
  \mscsym@interbar
  \normalbar
}

\newrobustcmd*\stopbar{%
  \normalbar
  \mscsym@interbar
  \mscsym@thickbar
}

\endinput
